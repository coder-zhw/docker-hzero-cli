(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[7,12],{1379:function(e,t,a){e.exports=a(3)(111)},1397:function(e,t,a){e.exports=a(3)(261)},1421:function(e,t,a){e.exports=a(3)(234)},1430:function(e,t,a){e.exports=a(3)(144)},1518:function(e,t,a){e.exports=a(3)(1136)},282:function(e,t,a){"use strict";a.r(t);a(319);var r=a(1379),n=(a(1526),a(1518)),o=a(2),i=a.n(o),s=a(19),c=a(64),d=(a(487),a(318)),l=a(15),u=a(42),p=a(48),h=a(49),y=a(53),m=a(52),g=a(54),f=a(94),v=a(220),C=a.n(v),b=a(0),O=a.n(b),w=a(30),j=a.n(w),k=a(84),E=a(1568),S=a.n(E),L=(a(1575),a(1577),a(95)),I=a(40),R=a(18),P=a(1531),x=a(1396),z=a(186),D=a(57),T=a(185),A=a.n(T),N=a(187);function W(e){return B.apply(this,arguments)}function B(){return B=Object(s["a"])(i.a.mark(function e(t){var a,r;return i.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(!N["a"].has({module:"hzero-front",feature:"cards",key:t})){e.next=7;break}if(a=N["a"].get({module:"hzero-front",feature:"cards",key:t}),!A()(a&&a.component)){e.next=7;break}return e.next=5,a.component();case 5:return r=e.sent,e.abrupt("return",r);case 7:return e.abrupt("return",null);case 8:case"end":return e.stop()}},e)})),B.apply(this,arguments)}function M(e){N["a"].set({module:"hzero-front",feature:"cards",key:e.code,data:{component:e.component}})}var U,F,V,H,K,J,_,q,G,Q,X,Y,Z,$,ee,te,ae,re,ne,oe,ie=a(499),se=a.n(ie),ce=a(498);a.d(t,"default",function(){return ye});var de=S.a,le={backgroundColor:"rgb(243, 244, 245)",padding:"0 6px 0 6px"},ue={position:"relative"},pe={float:"right",marginRight:"12px"},he={float:"right",marginRight:"12px"},ye=(U=Object(k["connect"])(function(e){var t=e.workplace,a=e.loading,r=e.global,n=void 0===r?{}:r;return{workplace:t,loadAssignableCardsLoading:a.effects["workplace/fetchCards"],activeTabKey:n.activeTabKey}}),F=Object(x["a"])({code:["hzero.workplace"]}),V=Object(L["Bind"])(),H=Object(L["Debounce"])(D["a"]),K=Object(L["Bind"])(),J=Object(L["Bind"])(),_=Object(L["Bind"])(),q=Object(L["Bind"])(),G=Object(L["Bind"])(),Q=Object(L["Bind"])(),X=Object(L["Bind"])(),Y=Object(L["Bind"])(),Z=Object(L["Bind"])(),$=Object(L["Bind"])(),ee=Object(L["Bind"])(),te=Object(L["Bind"])(),U(ae=Object(I["withRouter"])(ae=F((oe=ne=function(e){function t(e){var a;Object(p["a"])(this,t),a=Object(y["a"])(this,Object(m["a"])(t).call(this,e)),a.initCards={},a.state={modalVisible:!1,loading:!0,setting:!1,layout:[],cards:[],currentCards:[]},a.originLayout=null,a.originCurrentCards=null,a.mounted=!1;var r=e.cardsConfig,n=void 0===r?[]:r;return n.forEach(function(e){M(e)}),a}return Object(g["a"])(t,e),Object(h["a"])(t,[{key:"componentDidMount",value:function(){var e=this,t=this.props.dispatch;t({type:"workplace/fetchLayoutAndInit"}).then(function(t){t&&(e.setState({currentCards:t}),e.loadCards(t.map(function(t){var a=t.cardId,r=Object(u["a"])(t,["cardId"]);return 1===t.initFlag&&(e.initCards[String(a)]=t),Object(l["a"])({},r,{i:String(a)})})))}),this.mounted=!0,window.addEventListener("resize",this.handleWindowResize),this.handleWindowResize()}},{key:"componentWillUnmount",value:function(){this.mounted=!1,window.removeEventListener("resize",this.handleWindowResize),this.handleWindowResize.cancel()}},{key:"componentDidUpdate",value:function(e,t,a){this.needUpdateWidth&&(this.needUpdateWidth=!1,this.handleWindowResize())}},{key:"isInitCard",value:function(e){return!!this.initCards[e]}},{key:"handleWindowResize",value:function(){if(this.mounted){var e=this.props,t=e.match.path,a=e.activeTabKey;if(t===a){var r=j.a.findDOMNode(this);r instanceof HTMLElement&&this.setState({width:r.offsetWidth})}else this.needUpdateWidth=!0}}},{key:"renderCard",value:function(){var e=this,t=this.state,a=t.setting,r=void 0!==a&&a,n=t.cards,o=void 0===n?[]:n;return o.map(function(t){return!0===r?O.a.createElement("div",{key:t.name},t.component,O.a.createElement("div",{className:se.a.dragCard}),!e.isInitCard(t.name)&&O.a.createElement(d["default"],{type:"close",className:se.a.closeBtn,onClick:function(){e.handleRemoveCard(t.name)}})):O.a.createElement("div",{key:t.name,className:se.a.boxShadow},t.component)})}},{key:"onLayoutChange",value:function(e){this.setState({layout:e})}},{key:"saveLayout",value:function(){var e=this,t=this.state,a=t.layout,r=t.currentCards,n=this.props.dispatch;this.setState({setting:!1},function(){if(a){var t=C()(a),o=t.map(function(e){var t=e.i,a=Object(u["a"])(e,["i"]),n=r.find(function(e){return String(e.cardId)===t}),o=n.cardId,i=n.code,s=n.cardParams,c=n.name;return Object(l["a"])({},a,{cardId:o,code:i,name:c,cardParams:s})});n({type:"workplace/saveLayout",payload:Object(c["a"])(o)}).then(function(t){t?(z["a"].success(),e.originLayout=a,e.originCurrentCards=r):e.loadCards(e.originLayout)}).catch(function(){e.loadCards(e.originLayout)})}})}},{key:"startSettingLayout",value:function(){var e=this,t=this.state,a=t.layout,r=t.currentCards;this.setState({setting:!0},function(){e.originLayout=a,e.originCurrentCards=r})}},{key:"cancelSettingLayout",value:function(){this.loadCards(this.originLayout),this.setState({setting:!1})}},{key:"importCard",value:function(){var e=Object(s["a"])(i.a.mark(function e(t){var a;return i.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return a=null,e.prev=1,e.next=4,W(t);case 4:a=e.sent,e.next=10;break;case 7:e.prev=7,e.t0=e["catch"](1),a=null;case 10:return e.abrupt("return",a);case 11:case"end":return e.stop()}},e,null,[[1,7]])}));function t(t){return e.apply(this,arguments)}return t}()},{key:"importCards",value:function(){var e=Object(s["a"])(i.a.mark(function e(){var t,a,r,n=this,o=arguments;return i.a.wrap(function(e){while(1)switch(e.prev=e.next){case 0:for(t=o.length,a=new Array(t),r=0;r<t;r++)a[r]=o[r];return e.abrupt("return",Promise.all(a.map(function(e){return n.importCard(e)})));case 2:case"end":return e.stop()}},e)}));function t(){return e.apply(this,arguments)}return t}()},{key:"getCard",value:function(e){var t=this.state.currentCards;return t.find(function(t){return String(t.cardId)===e})}},{key:"loadCards",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],a=t,r=[];this.importCards.apply(this,Object(c["a"])(a.map(function(t){return e.getCard(t.i).code}))).then(function(t){r=a.map(function(a,r){var o=e.getCard(a.i),i=t[r];if(i){if(i.__esModule){var s=i.default;return{name:a.i,component:O.a.createElement(s,{cardParams:o.cardParams,name:o.name})}}var c=i;return{name:a.i,component:O.a.createElement(c,{cardParams:o.cardParams,name:o.name})}}return{name:a.i,component:O.a.createElement(n["default"],{loading:!0})}})}).finally(function(){e.setState({loading:!1,layout:a,cards:r})})}},{key:"handleRemoveCard",value:function(e){var t=this.state,a=t.layout,r=void 0===a?[]:a,n=t.currentCards,o=void 0===n?[]:n,i=r.filter(function(t){return t.i!==e}),s=o.filter(function(t){return t.cardId!==e});i.length,r.length,this.setState({currentCards:s}),this.loadCards(i)}},{key:"handleAddCard",value:function(e){var t=this.state,a=t.layout,r=void 0===a?[]:a,n=t.currentCards,o=void 0===n?[]:n,i=e.cardId;if(!r.some(function(e){return e.i===String(i)})){var s=[].concat(Object(c["a"])(r),[Object(l["a"])({},e,{i:String(i)})]);o.push(e),this.setState({currentCards:o}),this.loadCards(s)}}},{key:"hideModal",value:function(){this.setState({modalVisible:!1})}},{key:"showModal",value:function(){this.setState({modalVisible:!0})}},{key:"loadAssignableCards",value:function(){var e=this.props,t=e.dispatch,a=e.workplace.roleCards;return t({type:"workplace/fetchCards",payload:{roleCards:a}})}},{key:"render",value:function(){var e=this.props,t=e.workplace,a=t.prevRoleCards,o=t.roleCards,i=void 0===o?[]:o,s=t.catalogType,c=void 0===s?[]:s,d=e.loadAssignableCardsLoading,l=this.state,u=l.setting,p=void 0!==u&&u,h=l.layout,y=void 0===h?[]:h,m=l.loading,g=void 0===m||m,f=l.modalVisible,v=void 0!==f&&f,C=l.width,b=this.renderCard(),w={};return C&&(w.width=C),O.a.createElement(O.a.Fragment,null,O.a.createElement(P["b"],{title:R["a"].get("hzero.workplace.view.title.myWorkplace").d("\u6211\u7684\u5de5\u4f5c\u53f0")},!0!==g&&O.a.createElement("div",{style:{flex:"1 auto"}},!0===p?O.a.createElement(O.a.Fragment,null,O.a.createElement(r["default"],{type:"primary",icon:"save",style:pe,onClick:this.saveLayout},R["a"].get("hzero.common.button.save").d("\u4fdd\u5b58")),O.a.createElement(r["default"],{style:pe,icon:"minus-circle-o",onClick:this.cancelSettingLayout},R["a"].get("hzero.common.button.cancel").d("\u53d6\u6d88")),O.a.createElement(r["default"],{icon:"setting",style:pe,onClick:this.showModal},R["a"].get("hzero.workplace.view.title.cardsSetting").d("\u5361\u7247\u8bbe\u7f6e"))):O.a.createElement(r["default"],{icon:"layout",style:he,onClick:this.startSettingLayout},R["a"].get("hzero.common.button.settingLayout").d("\u8bbe\u7f6e\u5e03\u5c40")))),O.a.createElement(P["a"],{noCard:!0,style:le},!0===g?O.a.createElement(n["default"],{loading:!0}):O.a.createElement(de,Object.assign({},w,{style:ue,layout:y,className:se.a.gridLayoutContainer,isDraggable:p,isResizable:p,cols:120,rowHeight:1,margin:[12,12],onLayoutChange:this.onLayoutChange}),b),O.a.createElement(ce["default"],{loading:d,loadAssignableCards:this.loadAssignableCards,onRemoveCard:this.handleRemoveCard,onAddCard:this.handleAddCard,onCancel:this.hideModal,loadCards:this.loadCards,prevRoleCards:a,roleCards:i,visible:v,layout:y,catalogType:c,isInitCard:this.isInitCard,getCard:this.getCard})))}}]),t}(O.a.Component),ne.defaultProps={className:se.a.gridLayoutContainer,cols:20,rowHeight:28},re=oe,Object(f["a"])(re.prototype,"isInitCard",[V],Object.getOwnPropertyDescriptor(re.prototype,"isInitCard"),re.prototype),Object(f["a"])(re.prototype,"handleWindowResize",[H,K],Object.getOwnPropertyDescriptor(re.prototype,"handleWindowResize"),re.prototype),Object(f["a"])(re.prototype,"onLayoutChange",[J],Object.getOwnPropertyDescriptor(re.prototype,"onLayoutChange"),re.prototype),Object(f["a"])(re.prototype,"saveLayout",[_],Object.getOwnPropertyDescriptor(re.prototype,"saveLayout"),re.prototype),Object(f["a"])(re.prototype,"startSettingLayout",[q],Object.getOwnPropertyDescriptor(re.prototype,"startSettingLayout"),re.prototype),Object(f["a"])(re.prototype,"cancelSettingLayout",[G],Object.getOwnPropertyDescriptor(re.prototype,"cancelSettingLayout"),re.prototype),Object(f["a"])(re.prototype,"getCard",[Q],Object.getOwnPropertyDescriptor(re.prototype,"getCard"),re.prototype),Object(f["a"])(re.prototype,"loadCards",[X],Object.getOwnPropertyDescriptor(re.prototype,"loadCards"),re.prototype),Object(f["a"])(re.prototype,"handleRemoveCard",[Y],Object.getOwnPropertyDescriptor(re.prototype,"handleRemoveCard"),re.prototype),Object(f["a"])(re.prototype,"handleAddCard",[Z],Object.getOwnPropertyDescriptor(re.prototype,"handleAddCard"),re.prototype),Object(f["a"])(re.prototype,"hideModal",[$],Object.getOwnPropertyDescriptor(re.prototype,"hideModal"),re.prototype),Object(f["a"])(re.prototype,"showModal",[ee],Object.getOwnPropertyDescriptor(re.prototype,"showModal"),re.prototype),Object(f["a"])(re.prototype,"loadAssignableCards",[te],Object.getOwnPropertyDescriptor(re.prototype,"loadAssignableCards"),re.prototype),ae=re))||ae)||ae)||ae)},498:function(e,t,a){"use strict";a.r(t),a.d(t,"default",function(){return P});var r,n,o,i=a(50),s=(a(1515),a(1430)),c=(a(494),a(150)),d=(a(493),a(71)),l=(a(1496),a(1397)),u=(a(489),a(322)),p=(a(488),a(320)),h=a(15),y=a(48),m=a(49),g=a(53),f=a(52),v=a(54),C=a(94),b=a(83),O=a.n(b),w=a(0),j=a.n(w),k=a(95),E=a(57),S=a(18),L=a(499),I=a.n(L),R={minWidth:"120px"},P=(r=Object(k["Bind"])(),o=function(e){function t(){var e,a;Object(y["a"])(this,t);for(var r=arguments.length,n=new Array(r),o=0;o<r;o++)n[o]=arguments[o];return a=Object(g["a"])(this,(e=Object(f["a"])(t)).call.apply(e,[this].concat(n))),a.state={editCards:{}},a.timer={},a}return Object(v["a"])(t,e),Object(m["a"])(t,[{key:"componentDidUpdate",value:function(e){var t=this,a=e.visible,r=this.props,n=r.visible,o=r.loadAssignableCards;!1===a&&!0===n&&o().then(function(e){if(e){var a=t.props,r=a.prevRoleCards,n=a.roleCards,o=a.layout,i=a.catalogType,s=a.isInitCard,c={};i.forEach(function(e){c[e.value]={cards:[]}}),n.forEach(function(e){var t=String(e.cardId),a=o.find(function(e){return e.i===t}),n=Object(h["a"])({},e,a);n.isNew=!!r&&!r.some(function(e){return String(e.cardId)===t}),n.isInsert=!!a,n.isInit=s(t),c[n.catalogType]&&c[n.catalogType].cards.push(n)}),t.setState({editCards:c})}})}},{key:"shouldComponentUpdate",value:function(e){var t=e.visible,a=this.props.visible;return!0===t||!1===t&&!0===a}},{key:"componentWillUnmount",value:function(){O()(this.timer,function(e){clearTimeout(e)})}},{key:"render",value:function(){var e=this.props,t=e.visible,a=e.onCancel,r=e.loading,n=void 0!==r&&r;return j.a.createElement(u["default"],{destroyOnClose:!0,title:j.a.createElement("span",{className:I.a["card-setting-title"]},S["a"].get("hzero.workplace.view.title.cardsSetting").d("\u5361\u7247\u8bbe\u7f6e")),style:R,wrapClassName:"ant-modal-sidebar-right",transitionName:"move-right",className:I.a["card-setting"],visible:t,onCancel:a,footer:null},j.a.createElement(p["default"],{spinning:n},this.renderCatalogTypeRow()))}},{key:"renderCatalogTypeRow",value:function(){var e=this,t=this.props.catalogType,a=this.state.editCards;return t.map(function(t){var r=a[t.value];return r&&r.cards.length>0?j.a.createElement(j.a.Fragment,null,j.a.createElement("div",{key:"title",className:I.a["card-col-title"]},t.meaning),j.a.createElement(l["default"],{gutter:16,key:t.value,className:I.a["card-row"],type:"flex",justify:"start"},e.renderCatalogTypeCols(t,r.cards))):null})}},{key:"renderCatalogTypeCols",value:function(e,t){var a=this;return t.map(function(t){return j.a.createElement(s["default"],{key:t.cardId,className:I.a["card-col"]},j.a.createElement(d["default"].CheckableTag,{key:"is-insert",className:I.a["card-col-tag"],onChange:function(r){return a.handleCardInsertChange(t,e,r)},checked:t.isInsert,disabled:t.isInit},t.name),t.isNew&&j.a.createElement(c["default"],{key:"is-new",dot:!0}))})}},{key:"handleCardInsertChange",value:function(e,t,a){var r=this.state.editCards,n=r[t.value].cards,o=n.map(function(t){return t.cardId===e.cardId?Object(h["a"])({},t,{isInsert:a}):t});this.setState({editCards:Object(h["a"])({},r,Object(i["a"])({},t.value,{cards:o}))}),this.changeCard(e,a)}},{key:"changeCard",value:function(e,t){var a=this,r=String(e.cardId);this.timer[r]&&clearTimeout(this.timer[r]),this.timer[r]=setTimeout(function(){a.realChangeCard(e,t)},E["a"])}},{key:"realChangeCard",value:function(e,t){var a=this.props,r=a.onAddCard,n=a.onRemoveCard,o=String(e.cardId);t?r(e):n(o)}}]),t}(j.a.Component),n=o,Object(C["a"])(n.prototype,"realChangeCard",[r],Object.getOwnPropertyDescriptor(n.prototype,"realChangeCard"),n.prototype),n)}}]);