(window["webpackJsonppackages_hzero_front_hiam_name_"]=window["webpackJsonppackages_hzero_front_hiam_name_"]||[]).push([[221],{117:function(a,e,t){"use strict";t.r(e),t.d(e,"default",function(){return J});t(314);var n,o,i,r,l=t(313),c=(t(318),t(319)),p=(t(303),t(307)),s=t(58),d=t(426),u=t(295),m=t(296),f=t(298),g=t(297),h=t(299),v=t(301),b=(t(569),t(570)),y=t(61),w=t.n(y),I=t(452),O=t.n(I),j=t(324),z=t.n(j),E=t(691),k=t.n(E),N=t(1),S=t.n(N),C=t(793),U=t.n(C),x=(t(794),t(300)),A=t(302),P=t(354),D=t(292),L=t(291),_=t(484),B=t.n(_),T=b["default"].Dragger,F={KB:1024,MB:1048576,GB:2111832064};function M(a){var e;try{e=JSON.parse(a)}catch(t){return!1}return O()(e)&&!w()(e)}var J=(n=Object(x["Bind"])(),o=Object(x["Bind"])(),r=function(a){function e(){var a,t;Object(u["a"])(this,e);for(var n=arguments.length,o=new Array(n),i=0;i<n;i++)o[i]=arguments[i];return t=Object(f["a"])(this,(a=Object(g["a"])(e)).call.apply(a,[this].concat(o))),t.state={fileList:[],file:null,avatarPath:"",limitData:{},currentTenantId:Object(L["m"])()},t.cropper=void 0,t}return Object(h["a"])(e,a),Object(m["a"])(e,[{key:"componentDidMount",value:function(){this.handleSearch()}},{key:"handleSearch",value:function(){var a=this,e=this.props,t=e.dispatch,n=e.organizationId;t({type:"userInfo/fetchEnabledFile",payload:{tenantId:n,bucketName:D["e"],directory:"hiam02"}}).then(function(e){e&&a.setState({limitData:e})})}},{key:"handleCancel",value:function(){var a=this.props.onCancel;a(),this.setState({fileList:[],file:null})}},{key:"handleAvatarCrop",value:function(){var a=this.props.dispatch,e=this.cropper.getCroppedCanvas({width:256,height:256,imageSmoothingQuality:"high"});HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(a,e,t){for(var n=atob(this.toDataURL(e,t).split(",")[1]),o=n.length,i=new Uint8Array(o),r=0;r<o;r++)i[r]=n.charCodeAt(r);a(new Blob([i],{type:e||"image/png"}))}}),e.toBlob(function(e){a({type:"userInfo/updateState",payload:{imgFormData:e}})})}},{key:"beforeUpload",value:function(a){return this.setState(function(e){var t=e.fileList;return{fileList:[].concat(Object(d["a"])(t),[a]),file:a}}),this.props.dispatch({type:"userInfo/updateState",payload:{imgFormData:a}}),!1}},{key:"handleImgChange",value:function(a){var e=this.props.dispatch,t=new FileReader;t.readAsDataURL(a.file),t.onload=function(){e({type:"userInfo/updateState",payload:{uploadImgPreviewUrl:t.result,uploadImgName:a.file.name}})}}},{key:"validateUploadParams",value:function(){var a=this.state,e=a.file,t=a.limitData,n=t.fileFormat,o=t.storageSize,i=t.storageUnit;if(n||o){var r,l=!0;if(n){var c=n.split(",").map(function(a){return"image/".concat(a)});c.indexOf("image/jpg")>-1&&c.push("image/jpeg"),l=k()(c,e.type)>-1,r=l?"":A["a"].get("hiam.userInfo.view.message.fileTypeError").d("\u6587\u4ef6\u7c7b\u578b\u4e0d\u652f\u6301")}if(o&&l){var p=F[i]*o;l=p>e.size,r=l?"":A["a"].get("hzero.common.upload.error.size.custom",{fileSize:"".concat(o).concat(i)}).d("\u4e0a\u4f20\u6587\u4ef6\u5927\u5c0f\u4e0d\u80fd\u8d85\u8fc7: ".concat(o).concat(i))}return r}}},{key:"handleCutAvatar",value:function(){var a=this,e=this.state.fileList,t=this.props,n=t.dispatch,o=t.imgFormData,i=t.uploadImgName,r=t.organizationId,l=t.onCancel;n({type:"userInfo/updateState",payload:{imgUploadStatus:"uploading"}}),e.length>1&&e.pop();var c=this.validateUploadParams();if(c)return P["a"].error({message:c}),void n({type:"userInfo/updateState",payload:{imgUploadStatus:"waiting"}});n({type:"userInfo/uploadAvatar",payload:{organizationId:r,image:o,uploadImgName:i,bucketName:D["e"],directory:"hiam02"}}).then(function(e){M(e)&&JSON.parse(e).failed?P["a"].error({description:JSON.parse(e).message}):e&&a.setState({avatarPath:e},function(){n({type:"userInfo/saveAvatar",payload:e}).then(function(t){if(t){P["a"].success({message:A["a"].get("hiam.userInfo.view.message.updateSuccess").d("\u5934\u50cf\u4fdd\u5b58\u6210\u529f")}),a.setState(Object(s["a"])({},a.state,{fileList:[],file:null})),l();var o=window.dvaApp._store.getState(),i=o.userInfo,r=void 0===i?{}:i;n({type:"userInfo/updateState",payload:{userInfo:Object(s["a"])({},r.userInfo,{imageUrl:e})}}),n({type:"user/updateCurrentUser",payload:{imageUrl:e}})}})})})}},{key:"render",value:function(){var a=this,e=this.props,t=e.avatarVisible,n=e.imgUploadStatus,o=e.loading,i=e.uploadImgPreviewUrl,r=e.userInfo,s=e.onOk,d=this.state,u=d.fileList,m=d.limitData,f=d.currentTenantId,g=m.fileFormat,h=m.storageSize,v=m.storageUnit,y=!1,w=!1;return z()(m)||(y=!0,""!==m.fileFormat&&(w=!0)),S.a.createElement(l["default"],{visible:t,maskClosable:!1,title:A["a"].get("hiam.userInfo.view.message.changeAvatar").d("\u66f4\u6362\u5934\u50cf"),width:485,onOk:s,onCancel:this.handleCancel,footer:[S.a.createElement(p["default"],{key:"back",onClick:this.handleCancel},A["a"].get("hzero.common.button.cancel").d("\u53d6\u6d88")),S.a.createElement(p["default"],{key:"submit",type:"primary",onClick:function(){return a.handleCutAvatar()},disabled:0===u.length,loading:"uploading"===n||o},A["a"].get("hzero.common.button.save").d("\u4fdd\u5b58"))]},0===u.length?S.a.createElement(T,{className:B.a["avatar-uploader"],showUploadList:!1,beforeUpload:function(e){return a.beforeUpload(e)},onChange:function(e){return a.handleImgChange(e)},name:"image",action:"".concat(D["g"],"/v1/").concat(Object(L["z"])()?"".concat(f,"/"):"","files/byte"),data:{imagePath:r.imageUrl},accept:"image/jpeg,image/jpg,image/png,image/gif,image/bmp"},S.a.createElement("p",{className:"ant-upload-drag-icon"},S.a.createElement(c["default"],{type:"inbox"})),S.a.createElement("p",{className:"ant-upload-text"},A["a"].get("hiam.userInfo.view.message.uploadTips").d("\u70b9\u51fb\u6216\u5c06\u56fe\u7247\u62d6\u5230\u6b64\u533a\u57df\u4e0a\u4f20\u56fe\u7247")),y&&S.a.createElement("p",{className:"ant-upload-hint"},w&&A["a"].get("hiam.userInfo.view.message.uploadType",{uploadType:g}).d("\u652f\u6301".concat(g,"\u683c\u5f0f\uff0c")),A["a"].get("hzero.common.upload.error.size.custom",{fileSize:"".concat(h).concat(v)}).d("\u4e0a\u4f20\u6587\u4ef6\u5927\u5c0f\u4e0d\u80fd\u8d85\u8fc7: ".concat(h).concat(v)))):S.a.createElement("div",{className:B.a.uploader},S.a.createElement("div",{className:B.a["avatar-upload"]},S.a.createElement("div",{className:B.a["avatar-crop-wrap"]},S.a.createElement(U.a,{viewMode:1,preview:".img-preview",className:B.a["avatar-crop"],ref:function(e){a.cropper=e},src:i,aspectRatio:1,zoomable:!1,movable:!1,guides:!1,crop:function(){return a.handleAvatarCrop()}})),S.a.createElement("div",{className:B.a["avatar-preview-wrap"]},S.a.createElement("div",null,A["a"].get("hiam.userInfo.view.message.preview").d("\u9884\u89c8")),S.a.createElement("div",{className:B.a.preview},S.a.createElement("div",{className:"img-preview",style:{width:100,height:100}}),S.a.createElement("div",null,"100 * 100")),S.a.createElement("div",{className:B.a.preview},S.a.createElement("div",{className:"img-preview",style:{width:64,height:64}}),S.a.createElement("div",null,"64 * 64")),S.a.createElement("div",{className:B.a.preview},S.a.createElement("div",{className:"img-preview",style:{width:24,height:24}}),S.a.createElement("div",null,"24 * 24")))),S.a.createElement(b["default"],{className:B.a["avatar-uploader"],showUploadList:!1,beforeUpload:function(e){return a.beforeUpload(e)},onChange:function(e){return a.handleImgChange(e)},name:"image",action:"".concat(D["g"],"/v1/").concat(Object(L["z"])()?"".concat(f,"/"):"","files/byte"),data:{imagePath:r.imageUrl},accept:"image/jpeg,image/jpg,image/png,image/gif,image/bmp"},S.a.createElement(p["default"],{style:{marginTop:10}},S.a.createElement(c["default"],{type:"upload"}),A["a"].get("hiam.userInfo.view.option.selectPic").d("\u91cd\u65b0\u4e0a\u4f20")))))}}]),e}(S.a.PureComponent),i=r,Object(v["a"])(i.prototype,"handleSearch",[n],Object.getOwnPropertyDescriptor(i.prototype,"handleSearch"),i.prototype),Object(v["a"])(i.prototype,"handleCancel",[o],Object.getOwnPropertyDescriptor(i.prototype,"handleCancel"),i.prototype),i)},301:function(a,e,t){"use strict";function n(a,e,t,n,o){var i={};return Object.keys(n).forEach(function(a){i[a]=n[a]}),i.enumerable=!!i.enumerable,i.configurable=!!i.configurable,("value"in i||i.initializer)&&(i.writable=!0),i=t.slice().reverse().reduce(function(t,n){return n(a,e,t)||t},i),o&&void 0!==i.initializer&&(i.value=i.initializer?i.initializer.call(o):void 0,i.initializer=void 0),void 0===i.initializer&&(Object.defineProperty(a,e,i),i=null),i}t.d(e,"a",function(){return n})},314:function(a,e,t){"use strict";t(294),t(343),t(303)},343:function(a,e,t){a.exports={"ant-modal":"ant-modal","ant-modal-wrap":"ant-modal-wrap","ant-modal-title":"ant-modal-title","ant-modal-content":"ant-modal-content","ant-modal-close":"ant-modal-close","ant-modal-close-x":"ant-modal-close-x","ant-modal-header":"ant-modal-header","ant-modal-body":"ant-modal-body","ant-modal-footer":"ant-modal-footer","zoom-enter":"zoom-enter","zoom-appear":"zoom-appear","ant-modal-mask":"ant-modal-mask","ant-modal-mask-hidden":"ant-modal-mask-hidden","ant-modal-open":"ant-modal-open","vertical-center-modal":"vertical-center-modal","ant-confirm":"ant-confirm","ant-confirm-body-wrapper":"ant-confirm-body-wrapper","ant-confirm-body":"ant-confirm-body","ant-confirm-title":"ant-confirm-title","ant-confirm-content":"ant-confirm-content",anticon:"anticon","ant-confirm-btns":"ant-confirm-btns","ant-confirm-error":"ant-confirm-error","ant-confirm-warning":"ant-confirm-warning","ant-confirm-confirm":"ant-confirm-confirm","ant-confirm-info":"ant-confirm-info","ant-confirm-success":"ant-confirm-success"}},354:function(a,e,t){"use strict";var n=t(58),o=(t(338),t(311)),i=t(308),r=t(302);function l(a){var e=a||{},t=e.message,l=e.description,c=Object(i["a"])(e,["message","description"]);o["default"].success(Object(n["a"])({message:t||r["a"].get("hzero.common.notification.success").d("\u64cd\u4f5c\u6210\u529f"),description:l,duration:2.5,className:"success"},c))}function c(a){var e=a||{},t=e.message,l=e.description,c=Object(i["a"])(e,["message","description"]);o["default"].error(Object(n["a"])({message:t||r["a"].get("hzero.common.notification.error").d("\u64cd\u4f5c\u5931\u8d25"),description:l,duration:2.5,className:"error"},c))}function p(a){var e=a||{},t=e.message,l=e.description,c=Object(i["a"])(e,["message","description"]);o["default"].warning(Object(n["a"])({message:t||r["a"].get("hzero.common.notification.warn").d("\u64cd\u4f5c\u5f02\u5e38"),description:l,duration:2.5,className:"warn"},c))}function s(a){var e=a||{},t=e.message,r=e.description,l=Object(i["a"])(e,["message","description"]);o["default"].info(Object(n["a"])({message:t,description:r,duration:2.5,className:"info"},l))}e["a"]={success:l,error:c,warning:p,info:s}},569:function(a,e,t){"use strict";t(294),t(618),t(571),t(334)},618:function(a,e,t){a.exports={"ant-upload":"ant-upload","ant-upload-btn":"ant-upload-btn","ant-upload-select":"ant-upload-select","ant-upload-select-picture-card":"ant-upload-select-picture-card","ant-upload-drag":"ant-upload-drag","ant-upload-drag-hover":"ant-upload-drag-hover","ant-upload-disabled":"ant-upload-disabled","ant-upload-drag-container":"ant-upload-drag-container","ant-upload-drag-icon":"ant-upload-drag-icon",anticon:"anticon","ant-upload-text":"ant-upload-text","ant-upload-hint":"ant-upload-hint","anticon-plus":"anticon-plus","ant-upload-list":"ant-upload-list","ant-upload-list-item":"ant-upload-list-item","ant-upload-list-item-name":"ant-upload-list-item-name","ant-upload-list-item-info":"ant-upload-list-item-info","anticon-loading":"anticon-loading","anticon-paper-clip":"anticon-paper-clip","anticon-cross":"anticon-cross","ant-upload-list-item-error":"ant-upload-list-item-error","ant-upload-list-item-progress":"ant-upload-list-item-progress","ant-upload-list-picture":"ant-upload-list-picture","ant-upload-list-picture-card":"ant-upload-list-picture-card","ant-upload-list-item-file-name":"ant-upload-list-item-file-name","ant-upload-list-item-uploading":"ant-upload-list-item-uploading","ant-upload-list-item-thumbnail":"ant-upload-list-item-thumbnail","ant-upload-list-item-icon":"ant-upload-list-item-icon","ant-upload-list-item-action-remove":"ant-upload-list-item-action-remove","ant-upload-list-item-picture-card":"ant-upload-list-item-picture-card","ant-upload-list-item-actions":"ant-upload-list-item-actions","anticon-eye-o":"anticon-eye-o","anticon-download":"anticon-download","anticon-upload":"anticon-upload","anticon-picture":"anticon-picture","ant-upload-list-item-uploading-text":"ant-upload-list-item-uploading-text","ant-upload-success-icon":"ant-upload-success-icon","ant-upload-animate-enter":"ant-upload-animate-enter","ant-upload-animate-leave":"ant-upload-animate-leave","ant-upload-animate-inline-enter":"ant-upload-animate-inline-enter","ant-upload-animate-inline-leave":"ant-upload-animate-inline-leave",uploadAnimateIn:"uploadAnimateIn",uploadAnimateOut:"uploadAnimateOut",uploadAnimateInlineIn:"uploadAnimateInlineIn",uploadAnimateInlineOut:"uploadAnimateInlineOut"}},691:function(a,e,t){var n=t(358),o=t(433),i=Math.max;function r(a,e,t){var r=null==a?0:a.length;if(!r)return-1;var l=null==t?0:o(t);return l<0&&(l=i(r+l,0)),n(a,e,l)}a.exports=r},794:function(a,e,t){a.exports={"cropper-container":"cropper-container","cropper-wrap-box":"cropper-wrap-box","cropper-canvas":"cropper-canvas","cropper-drag-box":"cropper-drag-box","cropper-crop-box":"cropper-crop-box","cropper-modal":"cropper-modal","cropper-view-box":"cropper-view-box","cropper-dashed":"cropper-dashed","dashed-h":"dashed-h","dashed-v":"dashed-v","cropper-center":"cropper-center","cropper-face":"cropper-face","cropper-line":"cropper-line","cropper-point":"cropper-point","line-e":"line-e","line-n":"line-n","line-w":"line-w","line-s":"line-s","point-e":"point-e","point-n":"point-n","point-w":"point-w","point-s":"point-s","point-ne":"point-ne","point-nw":"point-nw","point-sw":"point-sw","point-se":"point-se","cropper-invisible":"cropper-invisible","cropper-bg":"cropper-bg","cropper-hide":"cropper-hide","cropper-hidden":"cropper-hidden","cropper-move":"cropper-move","cropper-crop":"cropper-crop","cropper-disabled":"cropper-disabled"}}}]);